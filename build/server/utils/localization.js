// Generated by CoffeeScript 1.9.0
var Polyglot, cozydb, drainWaiting, translator, waiting;

cozydb = require('cozydb');

Polyglot = require('node-polyglot');

waiting = [];

translator = null;

drainWaiting = function(err, translator) {
  var callback, _i, _len, _results;
  _results = [];
  for (_i = 0, _len = waiting.length; _i < _len; _i++) {
    callback = waiting[_i];
    _results.push(callback(err, translator));
  }
  return _results;
};

exports.getPolyglot = function(callback) {
  if (translator) {
    return callback(null, translator);
  } else {
    return waiting.push(callback);
  }
};

cozydb.api.getCozyLocale(function(err, locale) {
  var e, phrases, polyglot;
  phrases = (function() {
    try {
      return require("../../client/app/locales/" + locale);
    } catch (_error) {
      e = _error;
      return require("../../client/app/locales/en");
    }
  })();
  try {
    polyglot = new Polyglot({
      locale: locale,
      phrases: phrases
    });
  } catch (_error) {
    e = _error;
    return drainWaiting(e, function() {});
  }
  translator = polyglot.t.bind(polyglot);
  return drainWaiting(null, translator);
});
