// Generated by CoffeeScript 1.10.0
var Polyglot, cozydb, drainWaiting, translator, waiting;

cozydb = require('cozydb');

Polyglot = require('node-polyglot');

waiting = [];

translator = null;

drainWaiting = function(err, translator) {
  var callback, i, len, results;
  results = [];
  for (i = 0, len = waiting.length; i < len; i++) {
    callback = waiting[i];
    results.push(callback(err, translator));
  }
  return results;
};

exports.getPolyglot = function(callback) {
  if (translator) {
    return callback(null, translator);
  } else {
    return waiting.push(callback);
  }
};

cozydb.api.getCozyLocale(function(err, locale) {
  var e, error, phrases, polyglot;
  phrases = (function() {
    var error;
    try {
      return require("../../client/app/locales/" + locale);
    } catch (error) {
      e = error;
      return require("../../client/app/locales/en");
    }
  })();
  try {
    polyglot = new Polyglot({
      locale: locale,
      phrases: phrases
    });
  } catch (error) {
    e = error;
    return drainWaiting(e, function() {});
  }
  translator = polyglot.t.bind(polyglot);
  return drainWaiting(null, translator);
});
